<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="homeStyle.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide">
</head>
	<body class="noSelect" style="font-family: 'Audiowide', sans-serif;">
		<div id="mainClicker" class="mainDisplay">
			<p class="moneyDisplay">$<span id="money">0</span></p>
			<p class="mpsDisplay">$<span id="mpsMoney">0</span> per second</p>
		</div>
		<div class="grid">
			<div id="NEO" class="mainDisplay secondaryDisplay col">
				<p class="buttonText">Buy Kamigawa booster draft <i class="fa-solid fa-money-check-dollar"></i></p>			
			</div>

			<div id="shop" class="mainDisplay secondaryDisplay col">
				<p class="buttonText">Shop <i class="fa-solid fa-shopping-cart"></i><p>
			</div>
		</div>

		<!-- Display pack opening cards -->
		<div class="modal fade modal-lg" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-body" style="text-align: center;">		      		
				<i class="fa fa-refresh modalElements" id="flipCard" style="cursor: pointer; display: block; margin-bottom: 10px;"></i>
		        <img id="packOpeningCards"></img>
		        <p id="cardPrice" class="modalElements">Price: $<span id="priceValue"></span></p>
		      </div>
		      <div class="modal-footer">
		      	<button type="button" id="sellCardButton" class="btn btn-secondary">Sell</button>
		        <button type="button" id="closeModalButton" style="display: none;" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		        <button type="button" id="nextCardButton" class="btn btn-secondary">Next</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Shop Modal -->
		<div class="modal fade modal-lg" id="shopModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
    	      <div class="modal-header">
        		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			  </div>
		      <div class="modal-body" style="text-align: center;">		      		
		      </div>
		      <div class="modal-footer">
		      </div>
		    </div>
		  </div>
		</div>


		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.1.min.js" 
		integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
  		crossorigin="anonymous">  			
  		</script>
		<script type="text/javascript" src="data.js"></script>
		<script type="text/javascript">

		var count = 10;
		var mps = 0.0001
		var cards = JSON.parse(data);
		var pack, types, freq, flip

		var rareArr = Object.entries(cards[0].data.booster.arena.sheets.rareMythic.cards)
		var uncommonArr = Object.entries(cards[0].data.booster.arena.sheets.sfcUncommon.cards)
		var commonUncommonArr = Object.entries(cards[0].data.booster.arena.sheets.dfcCommonUncommon.cards)
		var commonArr = Object.entries(cards[0].data.booster.arena.sheets.sfcCommon.cards)
		var landArr = Object.entries(cards[0].data.booster.arena.sheets.land.cards)

		$(document).ready(function(){
			$('#cardModal').modal({backdrop: 'static', keyboard: false})
			updateMoney()
			setInterval(function () {
				count = count+mps
				updateMoney()
			}, 1000);
		})

		function getRandomInt(max) {
  			return Math.floor(Math.random() * max);
		}

		function updateMoney() {
			displayCount = Math.round(count*100)/100
			displayCount = displayCount.toFixed(2)
			$('#money').text(displayCount)	
			$('#mpsMoney').text(mps)	
		}

		$('#mainClicker').on('click', () =>
		{
			count = count+0.01;
			updateMoney()
		})

		$('#nextCardButton').on('click', () =>
		{
			populateModal()
		})

		$('#sellCardButton').on('click', () =>
		{
			count = count + parseFloat($('#priceValue').text())
			updateMoney()
			populateModal()
		})

		$('#flipCard').on('click', () =>
		{
			flipCard()
		})

		$('#NEO').on('click', async function()
		{
			if (count > 4) {
				$('#cardModal').modal('show')
				$('#closeModalButton').css('display', 'none')
				$('#nextCardButton').css('display', 'inline-block')
				count = count - 4
				updateMoney()
				getPackCards()
				populateModal()	
			}		

		})

		$('#shop').on('click', function()
		{	
			$('#shopModal').modal('show');
		})

		async function getUncommonCard() {
			var uncommonCardId = uncommonArr[getRandomInt(uncommonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == uncommonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal)
				$('#priceValue').text(data.prices.usd)
			});	
		}

		async function getCommonUncommonCard() {
			var commonUncommonCardId = commonUncommonArr[getRandomInt(commonUncommonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == commonUncommonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
		  		if (data.card_faces[0].image_uris.normal != undefined) {
		  			flip = data.card_faces
					$('#packOpeningCards').prop('src',data.card_faces[0].image_uris.normal)
					$('#priceValue').text(data.prices.usd)
					$('#flipCard').css('visibility', 'visible');
				} else {
					$('#packOpeningCards').prop('src',data.image_uris.normal)
					$('#priceValue').text(data.prices.usd)
				}
			});	
		}

		async function getCommonCard() {
			var commonCardId = commonArr[getRandomInt(commonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == commonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal)
				$('#priceValue').text(data.prices.usd)
			});	
		}

		async function getLandCard() {
			var landCardId = landArr[getRandomInt(landArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == landCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal) 
				$('#priceValue').text(data.prices.usd)   				
			});	
		}

		async function getRareCard() {
			var rareCardId = rareArr[getRandomInt(rareArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == rareCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
		  		if (data.image_uris.normal) {
					$('#packOpeningCards').prop('src',data.image_uris.normal)
					$('#priceValue').text(data.prices.usd)
				} else {
					$('#packOpeningCards').prop('src',data.image_uris.small)
					$('#priceValue').text(data.prices.usd)
				}
			});	
		}

		function getPackCards(){
			pack = cards[0].data.booster.arena.boosters[0].contents
			types = Object.keys(pack)
			freq = Object.values(pack)
		}

		//Make this switch work proper
		async function populateModal(){	
			$('#flipCard').css('visibility', 'hidden');		
			if (freq[0] > 0) {
				switch(types[0]){
					case 'land': 
						await getLandCard()
						break

					case 'sfcCommon': 
						await getCommonCard()
						break

					case 'dfcCommonUncommon': 
						getCommonUncommonCard()
						break

					case 'sfcUncommon': 
						await getUncommonCard()
						break

					case 'rareMythic': 
						await getRareCard()
						break
				}
				freq[0] = freq[0]-1
				if (freq[0] == 0) {
					freq.shift()
					types.shift()
					if (freq[0] == undefined){
						$('#nextCardButton').css('display', 'none')
						$('#closeModalButton').css('display', 'inline-block')
					}
				}
			} else if (freq[0] == undefined){
						$('#cardModal').modal('hide')
					}			
		}

		function flipCard() {
			if (flip[0].image_uris.normal == $('#packOpeningCards').attr('src')) {
				$('#packOpeningCards').prop('src',flip[1].image_uris.normal)
			} else {
				$('#packOpeningCards').prop('src',flip[0].image_uris.normal)
			}
		}



		</script>

	</body>
</html>