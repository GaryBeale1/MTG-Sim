<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="homeStyle.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide">
</head>
	<body class="noSelect" style="font-family: 'Audiowide', sans-serif;">
		<div id="mainClicker" class="mainDisplay">
			<p class="moneyDisplay">$<span id="money">0</span></p>
			<p class="mpsDisplay">$<span id="mpsMoney">0</span> per second</p>
		</div>
		<div class="grid">
			<div id="packPurchase" class="mainDisplay secondaryDisplay col">
				<p class="buttonText">Buy Pack <i class="fa-solid fa-money-check-dollar"></i></p>			
			</div>

			<div id="SNC" class="mainDisplay secondaryDisplay col">
				<p class="buttonText">Inventory (Coming Soon) <i class="fa-solid fa-money-check-dollar"></i></p>			
			</div>

			<div id="shop" class="mainDisplay secondaryDisplay col">
				<p class="buttonText">Shop (WIP) <i class="fa-solid fa-shopping-cart"></i><p>
			</div>
		</div>

		<!-- Display pack opening cards -->
		<div class="modal fade modal-lg" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-body" style="text-align: center;">		      		
				<i class="fa fa-refresh modalElements" id="flipCard" style="cursor: pointer; display: block; margin-bottom: 10px;"></i>
		        <img id="packOpeningCards"></img>
		        <p id="cardPrice" class="modalElements">Price: $<span id="priceValue"></span></p>
		      </div>
		      <div class="modal-footer">
		      	<button type="button" id="sellCardButton" class="btn btn-secondary">Sell</button>
		        <button type="button" id="closeModalButton" style="display: none;" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		        <button type="button" id="nextCardButton" class="btn btn-secondary">Next</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Pack Modal -->
		<div class="modal fade modal-lg" id="packPurchaseModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
    	      <div class="modal-header">
    	      	<h3>Buy A Pack</h3>
        		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			  </div>
		      <div class="modal-body" style="text-align: center;">	
		    	<table>
		    		<tr>
		    			<td>Pack</td>
		    			<td>Price</td>
		    			<td></td>
		    		</tr>
		    		<tr>
		    			<td>Kamigawa Neon Dynasty</td>
		    			<td>$2.00</td>
		    			<td><button id="NEO">Buy</button></td>
		    		</tr>
		    		<tr>
		    			<td>Streets of New Capenna</td>
		    			<td>$2.00</td>
		    			<td><button id="SNC">Buy</button></td>
		    		</tr>
		    	</table>	      		
		      </div>
		      <div class="modal-footer">
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Shop Modal -->
		<div class="modal fade modal-lg" id="shopModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
    	      <div class="modal-header">
        		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			  </div>
		      <div class="modal-body" style="text-align: center;">	
		    	<table>
		    		<tr>
		    			<td>Item</td>
		    			<td>Price</td>
		    			<td><button>Buy</button></td>
		    		</tr>
		    	</table>	      		
		      </div>
		      <div class="modal-footer">
		      </div>
		    </div>
		  </div>
		</div>


		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.1.min.js" 
		integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
  		crossorigin="anonymous">  			
  		</script>
		<script type="text/javascript" src="NEO.js"></script>
		<script type="text/javascript" src="SNC.js"></script>
		<script type="text/javascript">

		var count = 10;
		var mps = 0.0001
		var NeoCards = JSON.parse(NEO);
		var SncCards = JSON.parse(SNC);
		var pack, types, freq, flip, cards

		var rareArr
		var uncommonArr
		var commonUncommonArr
		var commonArr
		var landArr

		$(document).ready(function(){
			$('#cardModal').modal({backdrop: 'static', keyboard: false})
			updateMoney()
			setInterval(function () {
				count = count+mps
				updateMoney()
			}, 1000);
		})

		function getRandomInt(max) {
  			return Math.floor(Math.random() * max);
		}

		function updateMoney() {
			displayCount = Math.round(count*100)/100
			displayCount = displayCount.toFixed(2)
			$('#money').text(displayCount)	
			$('#mpsMoney').text(mps)	
		}

		$('#mainClicker').on('click', () =>
		{
			count = count+0.01;
			updateMoney()
		})

		$('#nextCardButton').on('click', () =>
		{
			populateModal()
		})

		$('#sellCardButton').on('click', () =>
		{
			count = count + parseFloat($('#priceValue').text())
			updateMoney()
			populateModal()
		})

		$('#flipCard').on('click', () =>
		{
			flipCard()
		})

		$('#NEO').on('click', async function()
		{
			if (count > 4) {
				$('#packPurchaseModal').modal('hide');
				cards = NeoCards
				rareArr = Object.entries(cards[0].data.booster.default.sheets.rareMythic.cards)
				uncommonArr = Object.entries(cards[0].data.booster.default.sheets.uncommon.cards)
				commonUncommonArr = Object.entries(cards[0].data.booster.default.sheets.dfcCommonUncommon.cards)
				commonArr = Object.entries(cards[0].data.booster.default.sheets.common.cards)
				landArr = Object.entries(cards[0].data.booster.default.sheets.land.cards)

				$('#cardModal').modal('show')
				$('#closeModalButton').css('display', 'none')
				$('#nextCardButton').css('display', 'inline-block')
				count = count - 4
				updateMoney()
				getPackCards()
				populateModal()	
			}		

		})

		$('#SNC').on('click', async function()
		{
			if (count > 4) {
				$('#packPurchaseModal').modal('hide');
				cards = SncCards
				rareArr = Object.entries(cards[0].data.booster.default.sheets.rareMythic.cards)
				uncommonArr = Object.entries(cards[0].data.booster.default.sheets.uncommon.cards)
				commonUncommonArr = Object.entries(cards[0].data.booster.default.sheets.foil.cards)
				commonArr = Object.entries(cards[0].data.booster.default.sheets.common.cards)
				landArr = Object.entries(cards[0].data.booster.default.sheets.basic.cards)

				$('#cardModal').modal('show')
				$('#closeModalButton').css('display', 'none')
				$('#nextCardButton').css('display', 'inline-block')
				count = count - 4
				updateMoney()
				getPackCards()
				populateModal()	
			}		

		})

		$('#shop').on('click', function()
		{	
			$('#shopModal').modal('show');
		})

		$('#packPurchase').on('click', function()
		{	
			$('#packPurchaseModal').modal('show');
		})

		async function getUncommonCard() {
			var uncommonCardId = uncommonArr[getRandomInt(uncommonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == uncommonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal)
				$('#priceValue').text(data.prices.usd)
			});	
		}

		async function getCommonUncommonCard() {
			var commonUncommonCardId = commonUncommonArr[getRandomInt(commonUncommonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == commonUncommonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
		  		if (data.card_faces[0].image_uris.normal != undefined) {
		  			flip = data.card_faces
					$('#packOpeningCards').prop('src',data.card_faces[0].image_uris.normal)
					$('#priceValue').text(data.prices.usd)
					$('#flipCard').css('visibility', 'visible');
				} else {
					$('#packOpeningCards').prop('src',data.image_uris.normal)
					$('#priceValue').text(data.prices.usd)
				}
			});	
		}

		async function getCommonCard() {
			var commonCardId = commonArr[getRandomInt(commonArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == commonCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal)
				$('#priceValue').text(data.prices.usd)
			});	
		}

		async function getLandCard() {
			var landCardId = landArr[getRandomInt(landArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == landCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
				$('#packOpeningCards').prop('src',data.image_uris.normal) 
				$('#priceValue').text(data.prices.usd)   				
			});	
		}

		async function getRareCard() {
			var rareCardId = rareArr[getRandomInt(rareArr.length)][0]
			let obj = cards[0].data.cards.find(o => o.uuid == rareCardId);
		  	$.get("https://api.scryfall.com/cards/"+obj.identifiers.scryfallId, function(data){
		  		if (data.image_uris.normal) {
					$('#packOpeningCards').prop('src',data.image_uris.normal)
					$('#priceValue').text(data.prices.usd)
				} else {
					$('#packOpeningCards').prop('src',data.image_uris.small)
					$('#priceValue').text(data.prices.usd)
				}
			});	
		}

		function getPackCards(){
			pack = cards[0].data.booster.default.boosters[0].contents
			types = Object.keys(pack)
			freq = Object.values(pack)
		}

		//Make this switch work proper
		async function populateModal(){	
			$('#flipCard').css('visibility', 'hidden');		
			if (freq[0] > 0) {
				switch(types[0]){
					case 'basic':
						await getLandCard()
						break

					case 'land': 
						await getLandCard()
						break

					case 'common': 
						await getCommonCard()
						break

					case 'dfcCommonUncommon': 
						getCommonUncommonCard()
						break

					case 'uncommon': 
						await getUncommonCard()
						break

					case 'rareMythic': 
						await getRareCard()
						break
				}
				freq[0] = freq[0]-1
				if (freq[0] == 0) {
					freq.shift()
					types.shift()
					if (freq[0] == undefined){
						$('#nextCardButton').css('display', 'none')
						$('#closeModalButton').css('display', 'inline-block')
					}
				}
			} else if (freq[0] == undefined){
						$('#cardModal').modal('hide')
					}			
		}

		function flipCard() {
			if (flip[0].image_uris.normal == $('#packOpeningCards').attr('src')) {
				$('#packOpeningCards').prop('src',flip[1].image_uris.normal)
			} else {
				$('#packOpeningCards').prop('src',flip[0].image_uris.normal)
			}
		}



		</script>

	</body>
</html>